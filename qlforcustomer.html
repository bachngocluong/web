<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản Lý Khách Hàng</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-image: url('https://png.pngtree.com/thumb_back/fh260/background/20230408/pngtree-clear-sky-white-clouds-blue-sky-background-image_2174284.jpg');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            font-family: Arial, sans-serif;
            color: #333;
        }
        
        .form-container {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 40px;
            border-radius: 10px;
            max-width: 600px;
            margin: 50px auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .error {
            color: red;
        }

        .table-container {
            max-height: 400px; 
            overflow-y: auto;
            margin-top: 20px;
        }
        ul {
            display: flex;
            list-style-type: none;
            background:linear-gradient(to right, rgb(1, 3, 27), #171ae3);
            margin: 0 auto;
            padding: 14px 0;
            border-radius: 5px;
            width: 100%;
            justify-content: center;
        }
        li {
            margin: 0 15px;
        }
        h3 {
            color: #fff;
            text-align: center;
            margin-left: -200px;
            margin-right: 100px;
            margin-top: 10px;
        }
        a {
            text-decoration: none;
            display: block;
            color: #ffffff;
            text-align: center;
            padding: 12px 14px;
            border: 1px solid #0736ff;
            border-radius: 6px;
            box-shadow: 1px 1px 6px rgba(7, 36, 255, 0.5);
            transition: background-color 0.3s, transform 0.3s;
        }
        a:hover {
            background-color: #333;
            color: #fff;
            transform: translateY(-3px);
        }
        .logo {
            width: 60px;
            height: 60px;
            margin-left: 8px;
            margin-right: 250px;
            vertical-align: middle;
        }
        h1, h2{
            background: linear-gradient(90deg, #000000, #0400f3);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            font-size: 50px;
        }
        #danhSachChuyenBayContainer {
    max-height: 400px; 
    overflow-y: auto; 
}

#danhSachChuyenBay thead th {
    position: sticky;
    top: 0;
    background-color: #4909ec; 
    color: rgb(255, 255, 255);
    z-index: 1;
}
#danhSachChuyenBay tbody{
    background-color: #ffffff;

}
.footer {
          background: linear-gradient(to right,#171ae3, rgb(1, 3, 27) );
            color: #ffffff;
            padding: 20px 0;
            text-align: center;
            margin-top: 20px;
        }
        .footer a {
            color: #ffffff;
            text-decoration: none;
            margin: 0 10px;
            transition: color 0.3s;
        }
        .footer a:hover {
            color: #cccccc;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <ul>
        <img src="logo.jpg" alt="Logo" class="logo">
        <h3>WL : Win every fLight </h3>
        <li><a href="home.html">Trang chủ</a></li>
        <li><a href="#">Thông tin chuyến bay đã đặt</a></li>
        <li><a href="#">Trợ giúp</a></li>
        <li><a href="login.html">Log in/Sign up</a></li>
    </ul>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Sửa thông tin cá nhân</h1>
    </div>
    <div class="container">
        <div class="form-container">
            <form id="formKhachHang" action="javascript:void(0);" method="post">
                <div class="form-group">
                    <label for="hoten">Họ tên:</label>
                    <input id="hoten" type="text" name="hoten" class="form-control"/>
                    <span id="hotenloi" class="error"></span> 
                </div>
                
                <div class="form-group">
                    <label for="cccd">CCCD:</label>
                    <input id="cccd" type="text" name="cccd" class="form-control"/>
                    <span id="cccdloi" class="error"></span>
                </div>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input id="email" type="text" name="email" class="form-control"/>
                    <span id="emailloi" class="error"></span>
                </div>
        
                <div class="form-group">
                    <label for="dt">Điện thoại:</label>
                    <input id="dt" type="text" name="dt" class="form-control"/>
                    <span id="dtloi" class="error"></span>
                </div>
                
                <div class="form-group">
                    <label>Giới tính:</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="gioitinh" value="nam" checked/>
                        <label class="form-check-label" for="nam">Nam</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="gioitinh" value="nu"/>
                        <label class="form-check-label" for="nu">Nữ</label>
                    </div>
                    <span id="gioitinhloi" class="error"></span>
                </div>
                
                <button type="submit" class="btn btn-primary" id="btnGui">Gửi</button>
            </form>
        </div>
        <div>
            <h2>Danh sách chuyến bay đã đặt </h2>
        </div>
        <div class="table-container">
            <table class="table table-bordered" id="danhSachChuyenBay"></table>
        </div>
    </div>
    <div class="footer">
        <div class="container">
            <p>&copy; 2024 WL: Win every fLight. All rights reserved.</p>
            <p>Contact us: <a href="mailto:vinh@winflight.com">WL@winflight.com</a></p>
            <p>
                <a href="#">SĐT : 0988241156 </a> |
                <a href="https://maps.app.goo.gl/Rk8J7Qg5cd9ZuGhJA?g_st=com.google.maps.preview.copy">Địa Chỉ : Quận Hà Đông Thành Phố Hà Nội </a>
            </p>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            taiDanhSachKhachHang();

            $('#btnGui').click(function () {
                var id = $('#formKhachHang').data('id');
                if (id) {
                    suaKhachHang(id);
                } else {
                    alert('Không tìm thấy thông tin khách hàng để sửa.');
                }
            });
        });

        function taiDanhSachKhachHang() {
            $('#danhSachChuyenBay').empty();
            $.get("http://localhost:3000/khachhang", function (data) {
                var tableBody = '<thead><tr><th>Họ tên</th><th>CCCD</th><th>Email</th><th>SĐT</th><th>Giới tính</th><th>Chuyến Bay</th><th>Thao tác</th></tr></thead>';
                tableBody += '<tbody>';
                data.forEach(function (khachhang) {
                    tableBody += '<tr>' +
                        '<td>' + khachhang.hoten + '</td>' +
                        '<td>' + khachhang.cccd + '</td>' +
                        '<td>' + khachhang.email + '</td>' +
                        '<td>' + khachhang.dt + '</td>' +
                        '<td>' + (khachhang.gioitinh === 'nam' ? 'Nam' : 'Nữ') + '</td>' +
                        '<td>';
                    
                    // Display flight details
                    if (khachhang.chuyenbay) {
                        var chuyenbay = khachhang.chuyenbay;
                        tableBody += 'Tên chuyến: ' + chuyenbay.tenchuyen + '<br>' +
                                     'Hãng bay: ' + chuyenbay.hangbay + '<br>' +
                                     'Điểm đi: ' + chuyenbay.diemdi + '<br>' +
                                     'Điểm đến: ' + chuyenbay.diemden + '<br>' +
                                     'Giờ: ' + chuyenbay.gio + '<br>' +
                                     'Ngày đi: ' + chuyenbay.ngaydi + '<br>';
                        if (chuyenbay.chieu === "1") {
                            tableBody += 'Ngày về: ' + chuyenbay.ngayve + '<br>';
                        } else {
                            tableBody += 'Ngày về: - <br>';
                        }
                        tableBody += 'Giá vé: ' + chuyenbay.giave + '<br>';
                    } else {
                        tableBody += 'Không có chuyến bay nào';
                    }
                    
                    tableBody += '</td>' +
                        '<td>' +
                        '<a href="#" class="btn btn-warning btn-sm" onclick="suaThongTinKhachHang(\'' + khachhang.id + '\')">Sửa</a> ' +
                        '</td>' +
                        '</tr>';
                });
                tableBody += '</tbody>';
                $('#danhSachChuyenBay').append(tableBody);
            });
        }

        function suaThongTinKhachHang(id) {
            $.get('http://localhost:3000/khachhang/' + id, function (data) {
                $('#formKhachHang').data('id', id);
                $('#hoten').val(data.hoten);
                $('#cccd').val(data.cccd);
                $('#email').val(data.email);
                $('#dt').val(data.dt);
                if (data.gioitinh === 'nam') {
                    $('input[name="gioitinh"][value="nam"]').prop('checked', true);
                } else {
                    $('input[name="gioitinh"][value="nu"]').prop('checked', true);
                }
            });
        }

        function suaKhachHang(id) {
            var hoten = $('#hoten').val();
            var cccd = $('#cccd').val();
            var email = $('#email').val();
            var dt = $('#dt').val();
            var gioitinh = $('input[name="gioitinh"]:checked').val();

            var data = {
                hoten: hoten,
                cccd: cccd,
                email: email,
                dt: dt,
                gioitinh: gioitinh
            };

            $.ajax({
                url: 'http://localhost:3000/khachhang/' + id,
                type: 'PUT',
                data: JSON.stringify(data),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function () {
                    taiDanhSachKhachHang();
                    datLaiForm();
                },
                error: function (xhr, status, error) {
                    console.error('Lỗi:', error);
                    alert('Đã xảy ra lỗi khi cập nhật thông tin khách hàng.');
                }
            });
        }
        function datLaiForm() {
            $('#formKhachHang')[0].reset();
            $('#formKhachHang').removeData('id');
        }
    </script>
</body>
</html>
